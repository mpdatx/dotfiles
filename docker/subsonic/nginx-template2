{{ range $host, $containers := groupBy $ "Env.VIRTUAL_HOST" }}
    {{ range $index, $value := $containers }}
    {{ with $address := first $value.Addresses }}
server {
    server_name {{ $host }};
    listen {{ $address.Port }};
    location / {
        proxy_pass http://{{ $address.IP }}:{{ $address.Port }};
        include /etc/nginx/proxy_params;
    }
}
{{ end }}
{{ end }}
{{ end }}
